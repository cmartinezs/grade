# ===================================================================
# Query Examples for Grade Web App
# Ejemplos de queries para el sistema de gestión de calificaciones
# Enfocado en lectura de Asignaturas, Unidades y Temas
# ===================================================================

# ===================================================================
# USUARIOS (Users)
# ===================================================================

# Obtener usuario por email
query GetUserByEmail($email: String!) @auth(level: USER) {
  users(where: {email: {eq: $email}}) {
    userId
    name
    email
    role
    createdAt
    updatedAt
    updatedBy
    deletedAt
  }
}

# Obtener usuario por userId
query GetUserById($userId: UUID!) @auth(level: USER) {
  users(where: {userId: {eq: $userId}}) {
    userId
    name
    email
    role
    createdAt
    updatedAt
    updatedBy
    deletedAt
  }
}

# ===================================================================
# ASIGNATURAS (Subjects)
# ===================================================================

# Listar todas las asignaturas
query ListSubjects @auth(level: USER) {
  subjects {
    subjectId
    name
    code
    levelId
    active
    createdAt
  }
}

# Obtener una asignatura por ID
query GetSubject($subjectId: UUID!) @auth(level: USER) {
  subject(key: { subjectId: $subjectId }) {
    subjectId
    name
    code
    active
    levelId
    createdAt
    createdBy
    updatedAt
    updatedBy
    deletedAt
    deletedBy
  }
}

# ===================================================================
# UNIDADES (Units)
# ===================================================================

# Listar todas las unidades
query ListUnits @auth(level: USER) {
  units {
    unitId
    name
    subjectId
    active
    createdAt
  }
}

# Obtener una unidad por ID
query GetUnit($unitId: UUID!) @auth(level: USER) {
  unit(key: { unitId: $unitId }) {
    unitId
    name
    subjectId
    active
    createdAt
    createdBy
    updatedAt
    updatedBy
    deletedAt
    deletedBy
  }
}

# ===================================================================
# TEMAS (Topics)
# ===================================================================

# Listar todos los temas
query ListTopics @auth(level: USER) {
  topics {
    topicId
    name
    unitId
    active
    createdAt
  }
}

# Obtener un tema por ID
query GetTopic($topicId: UUID!) @auth(level: USER) {
  topic(key: { topicId: $topicId }) {
    topicId
    name
    unitId
    active
    createdAt
    createdBy
    updatedAt
    updatedBy
    deletedAt
    deletedBy
  }
}

# ===================================================================
# CATEGORÍAS DE NIVELES (Level Categories)
# ===================================================================

# Listar todas las categorías de niveles
query ListLevelCategories @auth(level: USER) {
  levelCategories {
    categoryId
    code
    name
    description
    active
    createdAt
  }
}

# Obtener una categoría de nivel por ID
query GetLevelCategory($categoryId: UUID!) @auth(level: USER) {
  levelCategory(key: { categoryId: $categoryId }) {
    categoryId
    code
    name
    description
    active
    createdAt
    createdBy
    updatedAt
    updatedBy
    deletedAt
    deletedBy
  }
}

# ===================================================================
# NIVELES EDUCACIONALES (Educational Levels)
# ===================================================================

# Listar todos los niveles educacionales
query ListEducationalLevels @auth(level: USER) {
  educationalLevels {
    levelId
    categoryId
    code
    name
    description
    active
    createdAt
  }
}

# Obtener un nivel educacional por ID
query GetEducationalLevel($levelId: UUID!) @auth(level: USER) {
  educationalLevel(key: { levelId: $levelId }) {
    levelId
    categoryId
    code
    name
    description
    active
    createdAt
    createdBy
    updatedAt
    updatedBy
    deletedAt
    deletedBy
  }
}

# Obtener todos los niveles de una categoría específica
query GetLevelsByCategory($categoryId: UUID!) @auth(level: USER) {
  educationalLevels(where: { categoryId: { eq: $categoryId } }) {
    levelId
    code
    name
    description
    active
    createdAt
  }
}

# ===================================================================
# CURSOS (Courses)
# ===================================================================

# Listar todos los cursos del usuario autenticado
query ListCourses(
  $userId: UUID!,
  $firebaseId: String!
) @auth(expr: "firebaseId == auth.uid") {
  courses(where: { userId: { eq: $userId } }) {
    courseId
    name
    code
    section
    institutionName
    levelId
    userId
    active
    createdAt
  }
}

# Obtener un curso por ID (solo si pertenece al usuario autenticado)
query GetCourse($courseId: UUID!, $userId: UUID!, $firebaseId: String!) @auth(expr: "firebaseId == auth.uid") {
  courses(where: { courseId: { eq: $courseId }, userId: { eq: $userId } }) {
    courseId
    name
    code
    section
    institutionName
    levelId
    userId
    active
    createdAt
    createdBy
    updatedAt
    updatedBy
    deletedAt
    deletedBy
  }
}

# Obtener cursos por usuario (solo para el usuario autenticado)
query GetCoursesByUser($userId: UUID!, $firebaseId: String!) @auth(expr: "firebaseId == auth.uid") {
  courses(where: { userId: { eq: $userId } }) {
    courseId
    name
    code
    section
    institutionName
    levelId
    userId
    active
    createdAt
  }
}

# Obtener cursos por nivel educacional del usuario autenticado
query GetCoursesByLevel($userId: UUID!, $levelId: UUID!, $firebaseId: String!) @auth(expr: "firebaseId == auth.uid") {
  courses(where: { userId: { eq: $userId }, levelId: { eq: $levelId } }) {
    courseId
    name
    code
    section
    institutionName
    levelId
    userId
    active
    createdAt
  }
}

# ===================================================================
# PREGUNTAS (Questions)
# ===================================================================

# Listar todas las dificultades disponibles
query ListDifficulties @auth(level: USER) {
  difficulties {
    difficultyId
    level
    weight
    description
    active
  }
}

# Obtener una dificultad por ID
query GetDifficulty($difficultyId: UUID!) @auth(level: USER) {
  difficulty(key: { difficultyId: $difficultyId }) {
    difficultyId
    level
    weight
    description
    active
  }
}

# Listar todos los tipos de pregunta disponibles
query ListQuestionTypes @auth(level: USER) {
  questionTypes {
    questionTypeId
    code
    name
    description
    minOptions
    maxOptions
    correctOptions
    active
  }
}

# Obtener un tipo de pregunta por ID
query GetQuestionType($questionTypeId: UUID!) @auth(level: USER) {
  questionType(key: { questionTypeId: $questionTypeId }) {
    questionTypeId
    code
    name
    description
    minOptions
    maxOptions
    correctOptions
    active
  }
}

# Obtener un tipo de pregunta por código
query GetQuestionTypeByCode($code: String!) @auth(level: USER) {
  questionTypes(where: { code: { eq: $code } }) {
    questionTypeId
    code
    name
    description
    minOptions
    maxOptions
    correctOptions
    active
  }
}

# ===================================================================
# TAXONOMÍAS (Taxonomies)
# ===================================================================

# Listar todas las taxonomías
query ListTaxonomies @auth(level: USER) {
  taxonomies {
    taxonomyId
    code
    name
    description
    level
    active
    createdAt
  }
}

# Obtener una taxonomía por ID
query GetTaxonomy($taxonomyId: UUID!) @auth(level: USER) {
  taxonomy(key: { taxonomyId: $taxonomyId }) {
    taxonomyId
    code
    name
    description
    level
    active
    createdAt
    createdBy
    updatedAt
    updatedBy
    deletedAt
    deletedBy
  }
}

# Obtener una taxonomía por código
query GetTaxonomyByCode($code: String!) @auth(level: USER) {
  taxonomies(where: { code: { eq: $code } }) {
    taxonomyId
    code
    name
    description
    level
    active
    createdAt
  }
}

# Listar todas las taxonomías ordenadas por nivel (Bloom)
query ListTaxonomiesByLevel @auth(level: USER) {
  taxonomies(orderBy: [{level: ASC}]) {
    taxonomyId
    code
    name
    description
    level
    active
    createdAt
  }
}

# Listar preguntas públicas
query ListQuestionsByUser($userId: UUID!, $firebaseId: String!) @auth(expr: "firebaseId == auth.uid") {
  questions(where: { userId: { eq: $userId } }) {
    questionId
    text
    active
    version
    originalQuestionId
    topicId
    difficultyId
    questionTypeId
    taxonomyId
    userId
    allowPartialScore
    isPublic
    createdAt
    updatedAt
    updatedBy
    deletedAt
    deletedBy
  }
}

# ===================================================================
# ESTADÍSTICAS DEL DASHBOARD
# ===================================================================

# Obtener estadísticas agregadas para el dashboard
query GetDashboardStats($userId: UUID!, $firebaseId: String!) @auth(expr: "firebaseId == auth.uid") {
  # Preguntas del usuario
  questions(where: { userId: { eq: $userId }, deletedAt: { eq: null } }) {
    questionId
    active
    topicId
    difficultyId
    questionTypeId
    taxonomyId
    isPublic
    createdAt
  }
  
  # Taxonomías disponibles
  taxonomies(where: { active: { eq: true } }) {
    taxonomyId
    name
    code
    level
  }
  
  # Dificultades disponibles
  difficulties(where: { active: { eq: true } }) {
    difficultyId
    level
    weight
  }
  
  # Tipos de pregunta disponibles
  questionTypes(where: { active: { eq: true } }) {
    questionTypeId
    name
    code
  }
  
  # Asignaturas
  subjects(where: { active: { eq: true }, deletedAt: { eq: null } }) {
    subjectId
    name
    levelId
  }
  
  # Unidades
  units(where: { active: { eq: true }, deletedAt: { eq: null } }) {
    unitId
    name
    subjectId
  }
  
  # Temas
  topics(where: { active: { eq: true }, deletedAt: { eq: null } }) {
    topicId
    name
    unitId
  }
}

# Obtener una pregunta por ID (solo del usuario autenticado)
query GetQuestion($questionId: UUID!, $userId: UUID!, $firebaseId: String!) @auth(expr: "firebaseId == auth.uid") {
  questions(where: { questionId: { eq: $questionId }, userId: { eq: $userId } }) {
    questionId
    text
    active
    version
    originalQuestionId
    topicId
    difficultyId
    questionTypeId
    taxonomyId
    userId
    allowPartialScore
    isPublic
    createdAt
    updatedAt
    updatedBy
    deletedAt
    deletedBy
  }
  questionOptions(where: { questionId: { eq: $questionId } }) {
    questionOptionId
    text
    isCorrect
    position
    score
    questionId
  }
}

# Listar preguntas públicas (disponibles para todos)
query ListPublicQuestions @auth(level: USER) {
  questions(where: { isPublic: { eq: true }, active: { eq: true } }) {
    questionId
    text
    active
    version
    topicId
    difficultyId
    questionTypeId
    taxonomyId
    userId
    allowPartialScore
    createdAt
    updatedAt
  }
}

# Listar preguntas públicas filtradas por dificultad
query ListPublicQuestionsByDifficulty($difficultyId: UUID!) @auth(level: USER) {
  questions(where: { isPublic: { eq: true }, active: { eq: true }, difficultyId: { eq: $difficultyId } }) {
    questionId
    text
    active
    version
    topicId
    difficultyId
    questionTypeId
    taxonomyId
    userId
    allowPartialScore
    createdAt
    updatedAt
  }
}

# Listar preguntas públicas filtradas por tipo
query ListPublicQuestionsByType($questionTypeId: UUID!) @auth(level: USER) {
  questions(where: { isPublic: { eq: true }, active: { eq: true }, questionTypeId: { eq: $questionTypeId } }) {
    questionId
    text
    active
    version
    topicId
    difficultyId
    questionTypeId
    taxonomyId
    userId
    allowPartialScore
    createdAt
    updatedAt
  }
}

# Obtener opciones de una pregunta
query GetQuestionOptions($questionId: UUID!) @auth(level: USER) {
  questionOptions(where: { questionId: { eq: $questionId } }) {
    questionOptionId
    text
    isCorrect
    position
    score
    questionId
  }
}
