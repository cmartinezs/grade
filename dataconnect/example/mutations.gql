# ===================================================================
# Mutation Examples for Grade Web App
# Ejemplos de mutaciones para el sistema de gestión de calificaciones
# Enfocado en CRUD de Asignaturas, Unidades y Temas con Soft Delete
# ===================================================================

# ===================================================================
# USUARIOS (Users)
# ===================================================================

# Crear un nuevo usuario
mutation CreateUser(
  $userId: UUID!
  $authId: String!
  $name: String!
  $email: String!
  $role: String!
  $createdBy: UUID!
) @auth(level: USER) {
  user_insert(
    data: {
      userId: $userId
      authId: $authId
      name: $name
      email: $email
      role: $role
      createdBy: $createdBy
    }
  )
}

# Actualizar un usuario
mutation UpdateUser(
  $userId: UUID!
  $name: String
  $email: String
  $role: String
  $updatedBy: UUID!
  $updatedAt: Timestamp!
) @auth(expr: "updatedBy == auth.uid || auth.token.role == 'ADMIN'") {
  user_update(
    key: { userId: $userId }
    data: {
      name: $name
      email: $email
      role: $role
      updatedBy: $updatedBy
      updatedAt: $updatedAt
    }
  )
}

# ===================================================================
# ASIGNATURAS (Subjects)
# ===================================================================

# Crear una nueva asignatura
mutation CreateSubject(
  $subjectId: UUID!
  $name: String!
  $code: String!
  $createdBy: UUID!
) @auth(level: USER) {
  subject_insert(
    data: {
      subjectId: $subjectId
      name: $name
      code: $code
      createdBy: $createdBy
      active: true
    }
  )
}

# Actualizar una asignatura
mutation UpdateSubject(
  $subjectId: UUID!
  $name: String
  $code: String
  $updatedBy: UUID!
  $updatedAt: Timestamp!
) @auth(expr: "updatedBy == auth.uid || auth.token.role == 'ADMIN'") {
  subject_update(
    key: { subjectId: $subjectId }
    data: {
      name: $name
      code: $code
      updatedBy: $updatedBy
      updatedAt: $updatedAt
    }
  )
}

# Desactivar una asignatura (soft delete)
mutation DeactivateSubject(
  $subjectId: UUID!
  $deletedAt: Timestamp!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  subject_update(
    key: { subjectId: $subjectId }
    data: {
      active: false
      deletedAt: $deletedAt
      deletedBy: $deletedBy
    }
  )
}

# Reactivar una asignatura (undo soft delete)
mutation ReactivateSubject(
  $subjectId: UUID!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  subject_update(
    key: { subjectId: $subjectId }
    data: {
      active: true
      deletedAt: null
      deletedBy: null
    }
  )
}

# ===================================================================
# UNIDADES (Units)
# ===================================================================

# Crear una nueva unidad dentro de una asignatura
mutation CreateUnit(
  $unitId: UUID!
  $name: String!
  $description: String
  $subjectId: UUID!
  $createdBy: UUID!
) @auth(level: USER) {
  unit_insert(
    data: {
      unitId: $unitId
      name: $name
      description: $description
      subjectId: $subjectId
      createdBy: $createdBy
      active: true
    }
  )
}

# Actualizar una unidad
mutation UpdateUnit(
  $unitId: UUID!
  $name: String!
  $description: String
  $subjectId: UUID!
  $updatedBy: UUID!
  $updatedAt: Timestamp!
) @auth(expr: "updatedBy == auth.uid || auth.token.role == 'ADMIN'") {
  unit_update(
    key: { unitId: $unitId }
    data: {
      name: $name
      description: $description
      updatedBy: $updatedBy
      updatedAt: $updatedAt
    }
  )
}

# Desactivar una unidad (soft delete)
# Nota: Verificar si hay temas asociados antes de desactivar
mutation DeactivateUnit(
  $unitId: UUID!
  $deletedAt: Timestamp!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  unit_update(
    key: { unitId: $unitId }
    data: {
      active: false
      deletedAt: $deletedAt
      deletedBy: $deletedBy
    }
  )
}

# Reactivar una unidad (undo soft delete)
mutation ReactivateUnit(
  $unitId: UUID!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  unit_update(
    key: { unitId: $unitId }
    data: {
      active: true
      deletedAt: null
      deletedBy: null
    }
  )
}

# ===================================================================
# TEMAS (Topics)
# ===================================================================

# Crear un nuevo tema dentro de una unidad
mutation CreateTopic(
  $topicId: UUID!
  $name: String!
  $unitId: UUID!
  $createdBy: UUID!
) @auth(level: USER) {
  topic_insert(
    data: {
      topicId: $topicId
      name: $name
      unitId: $unitId
      createdBy: $createdBy
      active: true
    }
  )
}

# Actualizar un tema
mutation UpdateTopic(
  $topicId: UUID!
  $unitId: UUID!
  $name: String!
  $updatedBy: UUID!
  $updatedAt: Timestamp!
) @auth(expr: "updatedBy == auth.uid || auth.token.role == 'ADMIN'") {
  topic_update(
    key: { topicId: $topicId }
    data: {
      unitId: $unitId
      name: $name
      updatedBy: $updatedBy
      updatedAt: $updatedAt
    }
  )
}

# Desactivar un tema (soft delete)
# Nota: Verificar si hay preguntas asociadas antes de desactivar
mutation DeactivateTopic(
  $topicId: UUID!
  $deletedAt: Timestamp!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  topic_update(
    key: { topicId: $topicId }
    data: {
      active: false
      deletedAt: $deletedAt
      deletedBy: $deletedBy
    }
  )
}

# Reactivar un tema (undo soft delete)
mutation ReactivateTopic(
  $topicId: UUID!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  topic_update(
    key: { topicId: $topicId }
    data: {
      active: true
      deletedAt: null
      deletedBy: null
    }
  )
}

# ===================================================================
# CATEGORÍAS DE NIVELES (Level Categories)
# ===================================================================

# Crear una nueva categoría de nivel
mutation CreateLevelCategory(
  $categoryId: UUID!
  $code: String!
  $name: String!
  $description: String
  $createdBy: UUID!
) @auth(level: USER) {
  levelCategory_insert(
    data: {
      categoryId: $categoryId
      code: $code
      name: $name
      description: $description
      createdBy: $createdBy
      active: true
    }
  )
}

# Actualizar una categoría de nivel
mutation UpdateLevelCategory(
  $categoryId: UUID!
  $code: String
  $name: String
  $description: String
  $updatedBy: UUID!
  $updatedAt: Timestamp!
) @auth(expr: "updatedBy == auth.uid || auth.token.role == 'ADMIN'") {
  levelCategory_update(
    key: { categoryId: $categoryId }
    data: {
      code: $code
      name: $name
      description: $description
      updatedBy: $updatedBy
      updatedAt: $updatedAt
    }
  )
}

# Desactivar una categoría de nivel (soft delete)
mutation DeactivateLevelCategory(
  $categoryId: UUID!
  $deletedAt: Timestamp!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  levelCategory_update(
    key: { categoryId: $categoryId }
    data: {
      active: false
      deletedAt: $deletedAt
      deletedBy: $deletedBy
    }
  )
}

# Reactivar una categoría de nivel (undo soft delete)
mutation ReactivateLevelCategory(
  $categoryId: UUID!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  levelCategory_update(
    key: { categoryId: $categoryId }
    data: {
      active: true
      deletedAt: null
      deletedBy: null
    }
  )
}

# ===================================================================
# NIVELES EDUCACIONALES (Educational Levels)
# ===================================================================

# Crear un nuevo nivel educacional
mutation CreateEducationalLevel(
  $levelId: UUID!
  $categoryId: UUID!
  $code: String!
  $name: String!
  $description: String
  $createdBy: UUID!
) @auth(level: USER) {
  educationalLevel_insert(
    data: {
      levelId: $levelId
      categoryId: $categoryId
      code: $code
      name: $name
      description: $description
      createdBy: $createdBy
      active: true
    }
  )
}

# Actualizar un nivel educacional
mutation UpdateEducationalLevel(
  $levelId: UUID!
  $code: String
  $name: String
  $description: String
  $categoryId: UUID
  $updatedBy: UUID!
  $updatedAt: Timestamp!
) @auth(expr: "updatedBy == auth.uid || auth.token.role == 'ADMIN'") {
  educationalLevel_update(
    key: { levelId: $levelId }
    data: {
      code: $code
      name: $name
      description: $description
      categoryId: $categoryId
      updatedBy: $updatedBy
      updatedAt: $updatedAt
    }
  )
}

# Desactivar un nivel educacional (soft delete)
mutation DeactivateEducationalLevel(
  $levelId: UUID!
  $deletedAt: Timestamp!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  educationalLevel_update(
    key: { levelId: $levelId }
    data: {
      active: false
      deletedAt: $deletedAt
      deletedBy: $deletedBy
    }
  )
}

# Reactivar un nivel educacional (undo soft delete)
mutation ReactivateEducationalLevel(
  $levelId: UUID!
  $deletedBy: UUID!
) @auth(expr: "deletedBy == auth.uid || auth.token.role == 'ADMIN'") {
  educationalLevel_update(
    key: { levelId: $levelId }
    data: {
      active: true
      deletedAt: null
      deletedBy: null
    }
  )
}
