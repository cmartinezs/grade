# ===================================================================
# Grade Web App - Data Connect Schema
# Definición del esquema de datos para la aplicación de gestión de calificaciones
# ===================================================================

type User @table(name: "users", key: "userId") {
  # Identificador único del usuario
  userId: UUID! @col(name: "user_id")

  # Identificador de firebase Auth
  firebaseId: String! @col(name: "firebase_id")
  
  # Nombre del usuario
  name: String!
  
  # Correo electrónico del usuario
  email: String! @unique
  
  # Rol del usuario (Admin/Coordinator/Teacher)
  role: String!
  
  # Fecha de creación
  createdAt: Timestamp! @col(name: "created_at") @default(expr: "request.time")

  # ID del usuario que realizó la creación
  createdBy: UUID! @col(name: "created_by")

  # Fecha de última actualización
  updatedAt: Timestamp @col(name: "updated_at")
  
  # ID del usuario que realizó la última actualización
  updatedBy: UUID @col(name: "updated_by")
  
  # Fecha de eliminación (soft delete)
  deletedAt: Timestamp @col(name: "deleted_at")
  
  # ID del usuario que realizó la eliminación
  deletedBy: UUID @col(name: "deleted_by")
}

type Subject @table(name: "subjects", key: "subjectId") {
  # Identificador único de la asignatura
  subjectId: UUID! @col(name: "subject_id")
  
  # Nombre de la asignatura
  name: String!
  
  # Código de la asignatura (ej. MAT-101, ENG-102)
  code: String!
  
  # ID del nivel educacional al que pertenece esta asignatura
  levelId: UUID! @col(name: "level_fk")
  
  # Indicador de activo/inactivo
  active: Boolean! @default(value: true)
  
  # Fecha de creación
  createdAt: Timestamp! @col(name: "created_at") @default(expr: "request.time")
  
  # ID del usuario que realizó la creación
  createdBy: UUID! @col(name: "created_by")
  
  # Fecha de última actualización
  updatedAt: Timestamp @col(name: "updated_at")
  
  # ID del usuario que realizó la última actualización
  updatedBy: UUID @col(name: "updated_by")
  
  # Fecha de eliminación (soft delete)
  deletedAt: Timestamp @col(name: "deleted_at")
  
  # ID del usuario que realizó la eliminación
  deletedBy: UUID @col(name: "deleted_by")
}

type Unit @table(name: "units", key: "unitId") {
  # Identificador único de la unidad
  unitId: UUID! @col(name: "unit_id")
  
  # Identificador de la asignatura padre
  subjectId: UUID! @col(name: "subject_fk")
  
  # Nombre de la unidad
  name: String!
  
  # Descripción de la unidad
  description: String
  
  # Indicador de activo/inactivo
  active: Boolean! @default(value: true)
  
  # Fecha de creación
  createdAt: Timestamp! @col(name: "created_at") @default(expr: "request.time")
  
  # ID del usuario que realizó la creación
  createdBy: UUID! @col(name: "created_by")
  
  # Fecha de última actualización
  updatedAt: Timestamp @col(name: "updated_at")
  
  # ID del usuario que realizó la última actualización
  updatedBy: UUID @col(name: "updated_by")
  
  # Fecha de eliminación (soft delete)
  deletedAt: Timestamp @col(name: "deleted_at")
  
  # ID del usuario que realizó la eliminación
  deletedBy: UUID @col(name: "deleted_by")
}

type Topic @table(name: "topics", key: "topicId") {
  # Identificador único del tema
  topicId: UUID! @col(name: "topic_id")
  
  # Identificador de la unidad padre
  unitId: UUID! @col(name: "unit_fk")
  
  # Nombre del tema
  name: String!
  
  # Descripción del tema
  description: String
  
  # Indicador de activo/inactivo
  active: Boolean! @default(value: true)
  
  # Fecha de creación
  createdAt: Timestamp! @col(name: "created_at") @default(expr: "request.time")
  
  # ID del usuario que realizó la creación
  createdBy: UUID! @col(name: "created_by")
  
  # Fecha de última actualización
  updatedAt: Timestamp @col(name: "updated_at")
  
  # ID del usuario que realizó la última actualización
  updatedBy: UUID @col(name: "updated_by")
  
  # Fecha de eliminación (soft delete)
  deletedAt: Timestamp @col(name: "deleted_at")
  
  # ID del usuario que realizó la eliminación
  deletedBy: UUID @col(name: "deleted_by")
}

type QuestionType @table(name: "question_types", key: "questionTypeId") {
  # Identificador único del tipo de pregunta
  questionTypeId: UUID! @col(name: "question_type_id")
  
  # Código del tipo (TF, SC, MC)
  code: String!
  
  # Nombre del tipo de pregunta
  name: String!

  # Descripción del tipo de pregunta
  description: String
  
  # Cantidad minima de opciones
  minOptions: Int!
  
  # Cantidad máxima de opciones
  maxOptions: Int!
  
  # Cantidad de opciones correctas
  correctOptions: Int!
  
  # Indicador de activo/inactivo
  active: Boolean! @default(value: true)
}

type Difficulty @table(name: "difficulties", key: "difficultyId") {
  # Identificador único del nivel de dificultad
  difficultyId: UUID! @col(name: "difficulty_id")
  
  # Nivel de dificultad (Easy/Medium/Hard)
  level: String!
  
  # Peso o ponderador opcional
  weight: Int!

  # Descripción del tipo de pregunta
  description: String
  
  # Indicador de activo/inactivo
  active: Boolean! @default(value: true)
}

type Taxonomy @table(name: "taxonomies", key: "taxonomyId") {
  # Identificador único de la taxonomía
  taxonomyId: UUID! @col(name: "taxonomy_id")
  
  # Código de la taxonomía (ej. REMEMBER, UNDERSTAND, APPLY, ANALYZE, EVALUATE, CREATE)
  code: String! @unique
  
  # Nombre de la taxonomía
  name: String!
  
  # Descripción de la taxonomía
  description: String
  
  # Nivel de Bloom (1-6)
  level: Int!
  
  # Indicador de activo/inactivo
  active: Boolean! @default(value: true)
  
  # Fecha de creación
  createdAt: Timestamp! @col(name: "created_at") @default(expr: "request.time")
  
  # ID del usuario que realizó la creación
  createdBy: UUID! @col(name: "created_by")
  
  # Fecha de última actualización
  updatedAt: Timestamp @col(name: "updated_at")
  
  # ID del usuario que realizó la última actualización
  updatedBy: UUID @col(name: "updated_by")
  
  # Fecha de eliminación (soft delete)
  deletedAt: Timestamp @col(name: "deleted_at")
  
  # ID del usuario que realizó la eliminación
  deletedBy: UUID @col(name: "deleted_by")
}

type Question @table(name: "questions", key: "questionId") {
  # Identificador único de la pregunta
  questionId: UUID! @col(name: "question_id")
  
  # Texto de la pregunta
  text: String!
  
  # Indica si la pregunta está activa
  active: Boolean! @default(value: true)
  
  # Número de versión de la pregunta
  version: Int! @default(value: 1)
  
  # ID de la pregunta original (para versiones)
  originalQuestionId: UUID @col(name: "original_question_fk")
  
  # ID del tema al que pertenece
  topicId: UUID! @col(name: "topic_fk")
  
  # ID del nivel de dificultad
  difficultyId: UUID! @col(name: "difficulty_fk")
  
  # ID de la taxonomía
  taxonomyId: UUID! @col(name: "taxonomy_fk")
  
  # ID del tipo de pregunta
  questionTypeId: UUID! @col(name: "question_type_fk")
  
  # ID del usuario creador
  userId: UUID! @col(name: "user_fk")
  
  # Habilita puntaje parcial para preguntas de opción múltiple
  allowPartialScore: Boolean! @col(name: "allow_partial_score") @default(value: false)

  # Indicador de pregunta pública o privada
  isPublic: Boolean! @col(name: "is_public") @default(value: false)
  
  # Fecha de creación
  createdAt: Timestamp! @col(name: "created_at") @default(expr: "request.time")
  
  # Fecha de última actualización
  updatedAt: Timestamp @col(name: "updated_at")
  
  # ID del usuario que realizó la última actualización
  updatedBy: UUID @col(name: "updated_by")
  
  # Fecha de eliminación (soft delete)
  deletedAt: Timestamp @col(name: "deleted_at")
  
  # ID del usuario que realizó la eliminación
  deletedBy: UUID @col(name: "deleted_by")
}

type QuestionOption @table(name: "question_options", key: "questionOptionId") {
  # Identificador único de la opción de pregunta
  questionOptionId: UUID! @col(name: "question_option_id")
  
  # Texto de la opción
  text: String!
  
  # Indica si esta es la opción correcta
  isCorrect: Boolean! @col(name: "is_correct")
  
  # Posición de la opción (1..n)
  position: Int!
  
  # Puntuación asociada a esta opción
  score: Float
  
  # ID de la pregunta a la que pertenece
  questionId: UUID! @col(name: "question_fk")
}

type LevelCategory @table(name: "level_categories", key: "categoryId") {
  # Identificador único de la categoría de nivel
  categoryId: UUID! @col(name: "category_id")
  
  # Código de la categoría (ej. CAT_BASIC, CAT_MEDIA)
  code: String! @unique
  
  # Nombre de la categoría
  name: String!
  
  # Descripción de la categoría
  description: String
  
  # Indicador de activo/inactivo
  active: Boolean! @default(value: true)
  
  # Fecha de creación
  createdAt: Timestamp! @col(name: "created_at") @default(expr: "request.time")
  
  # ID del usuario que realizó la creación
  createdBy: UUID! @col(name: "created_by")
  
  # Fecha de última actualización
  updatedAt: Timestamp @col(name: "updated_at")
  
  # ID del usuario que realizó la última actualización
  updatedBy: UUID @col(name: "updated_by")
  
  # Fecha de eliminación (soft delete)
  deletedAt: Timestamp @col(name: "deleted_at")
  
  # ID del usuario que realizó la eliminación
  deletedBy: UUID @col(name: "deleted_by")
}

type EducationalLevel @table(name: "educational_levels", key: "levelId") {
  # Identificador único del nivel educacional
  levelId: UUID! @col(name: "level_id")
  
  # Identificador de la categoría padre
  categoryId: UUID! @col(name: "category_fk")
  
  # Código del nivel (ej. LEVEL_1B, LEVEL_2M)
  code: String! @unique
  
  # Nombre del nivel (ej. 1° Básico, 1° Medio)
  name: String!
  
  # Descripción del nivel
  description: String
  
  # Indicador de activo/inactivo
  active: Boolean! @default(value: true)
  
  # Fecha de creación
  createdAt: Timestamp! @col(name: "created_at") @default(expr: "request.time")
  
  # ID del usuario que realizó la creación
  createdBy: UUID! @col(name: "created_by")
  
  # Fecha de última actualización
  updatedAt: Timestamp @col(name: "updated_at")
  
  # ID del usuario que realizó la última actualización
  updatedBy: UUID @col(name: "updated_by")
  
  # Fecha de eliminación (soft delete)
  deletedAt: Timestamp @col(name: "deleted_at")
  
  # ID del usuario que realizó la eliminación
  deletedBy: UUID @col(name: "deleted_by")
}

type Course @table(name: "courses", key: "courseId") {
  # Identificador único del curso
  courseId: UUID! @col(name: "course_id")
  
  # Nombre del curso (ej. 1° Básico A, 2° Medio B)
  name: String!
  
  # Código del curso (ej. 1_Basico_A, 2_Medio_B)
  code: String! @unique
  
  # Institución educativa a la que pertenece el curso
  institutionName: String! @col(name: "institution_name")
  
  # ID del nivel educacional
  levelId: UUID! @col(name: "level_fk")
  
  # ID del usuario asociado al curso
  userId: UUID! @col(name: "user_fk")
  
  # Indicador de activo/inactivo
  active: Boolean! @default(value: true)
  
  # Fecha de creación
  createdAt: Timestamp! @col(name: "created_at") @default(expr: "request.time")
  
  # ID del usuario que realizó la creación
  createdBy: UUID! @col(name: "created_by")
  
  # Fecha de última actualización
  updatedAt: Timestamp @col(name: "updated_at")
  
  # ID del usuario que realizó la última actualización
  updatedBy: UUID @col(name: "updated_by")
  
  # Fecha de eliminación (soft delete)
  deletedAt: Timestamp @col(name: "deleted_at")
  
  # ID del usuario que realizó la eliminación
  deletedBy: UUID @col(name: "deleted_by")
}
